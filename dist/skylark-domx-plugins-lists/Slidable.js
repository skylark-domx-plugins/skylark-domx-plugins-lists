/**
 * skylark-domx-plugins-lists - The skylark list plugin library.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-domx/skylark-domx-plugins-lists/
 * @license MIT
 */
define(["skylark-langx/langx","skylark-domx-noder","skylark-domx-eventer","skylark-domx-query","skylark-domx-plugins","./lists"],function(t,i,s,e,o,n){"use strict";var l=o.Plugin.inherit({klassName:"Slidable",pluginName:"domx.plugins.lists.slidable",options:{slidesContainer:"div",titleElement:"h3",displayClass:"lark-domx-slidable-display",singleClass:"lark-domx-slidable-single",leftEdgeClass:"lark-domx-slidable-left",rightEdgeClass:"lark-domx-slidable-right",playingClass:"lark-domx-slidable-playing",controlsClass:"lark-domx-slidable-controls",slideClass:"slide",slideLoadingClass:"slide-loading",slideErrorClass:"slide-error",slideContentClass:"slide-content",toggleClass:"toggle",prevClass:"prev",nextClass:"next",closeClass:"close",playPauseClass:"play-pause",displayTransition:!0,clearSlides:!0,toggleControlsOnReturn:!0,toggleControlsOnSlideClick:!0,toggleSlideshowOnSpace:!0,enableKeyboardNavigation:!0,closeOnEscape:!1,closeOnSlideClick:!1,closeOnSwipeUpOrDown:!1,emulateTouchEvents:!0,stopTouchEventsPropagation:!1,hidePageScrollbars:!1,disableScroll:!0,carousel:!1,continuous:!0,unloadElements:!0,startSlideshow:!1,slideshowInterval:5e3,index:0,preloadRange:2,transitionSpeed:400,slideshowTransitionSpeed:void 0,hidePageScrollbars:!1,indicatorContainer:"ol",activeIndicatorClass:"active",thumbnailProperty:"thumbnail",thumbnailIndicators:!0,onopen:void 0,onopened:void 0,onslide:void 0,onslideend:void 0,onslidecomplete:void 0,onclose:void 0,onclosed:void 0},support:function(t){var i,s={touch:void 0!==window.ontouchstart||window.DocumentTouch&&document instanceof DocumentTouch},o={webkitTransition:{end:"webkitTransitionEnd",prefix:"-webkit-"},MozTransition:{end:"transitionend",prefix:"-moz-"},OTransition:{end:"otransitionend",prefix:"-o-"},transition:{end:"transitionend",prefix:""}};for(i in o)if(o.hasOwnProperty(i)&&void 0!==t.style[i]){s.transition=o[i],s.transition.name=i;break}function n(){var i,e,o=s.transition;document.body.appendChild(t),o&&(i=o.name.slice(0,-9)+"ransform",void 0!==t.style[i]&&(t.style[i]="translateZ(0)",e=window.getComputedStyle(t).getPropertyValue(o.prefix+"transform"),s.transform={prefix:o.prefix,name:i,translate:!0,translateZ:!!e&&"none"!==e})),void 0!==t.style.backgroundSize&&(s.backgroundSize={},t.style.backgroundSize="contain",s.backgroundSize.contain="contain"===window.getComputedStyle(t).getPropertyValue("background-size"),t.style.backgroundSize="cover",s.backgroundSize.cover="cover"===window.getComputedStyle(t).getPropertyValue("background-size")),document.body.removeChild(t)}return document.body?n():e(document).on("DOMContentLoaded",n),s}(document.createElement("div")),requestAnimationFrame:window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame,cancelAnimationFrame:window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame,_construct:function(t,i){if(this.overrided(t,i),this._velm=this.elmx(),this.list=this.options.items,this.num=this.list.length,this.initStartIndex(),!1===this.initWidget())return!1;this.initEventListeners(),this.onslide(this.index),this.ontransitionend(),this.options.startSlideshow&&this.play()},createIndicator:function(t){this.gallery;var i,s,o=this.indicatorPrototype.cloneNode(!1),n=t.title,l=this.options.thumbnailProperty;return this.options.thumbnailIndicators&&(l&&(i=t[l]),void 0===i&&(s=t.getElementsByTagName&&e(t).find("img")[0])&&(i=s.src),i&&(o.style.backgroundImage='url("'+i+'")')),n&&(o.title=n),o},addIndicator:function(t){if(this.indicatorContainer.length){var i=this.createIndicator(this.list[t]);i.setAttribute("data-index",t),this.indicatorContainer[0].appendChild(i),this.indicators.push(i)}},setActiveIndicator:function(t){this.indicators&&(this.activeIndicator&&this.activeIndicator.removeClass(this.options.activeIndicatorClass),this.activeIndicator=e(this.indicators[t]),this.activeIndicator.addClass(this.options.activeIndicatorClass))},slide:function(t,i){window.clearTimeout(this.timeout);var s,e,o,n=this.index;if(n!==t&&1!==this.num){if(i||(i=this.options.transitionSpeed),this.support.transform){for(this.options.continuous||(t=this.circle(t)),s=Math.abs(n-t)/(n-t),this.options.continuous&&(e=s,(s=-this.positions[this.circle(t)]/this.slideWidth)!==e&&(t=-s*this.num+t)),o=Math.abs(n-t)-1;o;)o-=1,this.move(this.circle((t>n?t:n)-o-1),this.slideWidth*s,0);t=this.circle(t),this.move(n,this.slideWidth*s,i),this.move(t,0,i),this.options.continuous&&this.move(this.circle(t-s),-this.slideWidth*s,0)}else t=this.circle(t),this.animate(n*-this.slideWidth,t*-this.slideWidth,i);this.onslide(t)}},getIndex:function(){return this.index},getNumber:function(){return this.num},prev:function(){(this.options.continuous||this.index)&&this.slide(this.index-1)},next:function(){(this.options.continuous||this.index<this.num-1)&&this.slide(this.index+1)},play:function(i){this.timeout&&(this.timeout.stop(),this.timeout=null),this.interval=i||this.options.slideshowInterval,this.elements[this.index]>1&&(this.timeout=t.debounce(this.slide.bind(this),this.interval,!0)(this.index+1,this.options.slideshowTransitionSpeed)),this._velm.addClass(this.options.playingClass)},pause:function(){this.timeout&&(this.timeout.stop(),this.timeout=null),this.interval=null,this._velm.removeClass(this.options.playingClass)},add:function(t){var i;for(t.concat||(t=Array.prototype.slice.call(t)),this.list.concat||(this.list=Array.prototype.slice.call(this.list)),this.list=this.list.concat(t),this.num=this.list.length,this.num>2&&null===this.options.continuous&&(this.options.continuous=!0,this._velm.removeClass(this.options.leftEdgeClass)),this._velm.removeClass(this.options.rightEdgeClass).removeClass(this.options.singleClass),i=this.num-t.length;i<this.num;i+=1)this.addSlide(i),this.positionSlide(i);this.positions.length=this.num,this.initSlides(!0)},resetSlides:function(){this.slidesContainer.empty(),this.unloadAllSlides(),this.slides=[],this.indicatorContainer.empty(),this.indicators=[]},handleClose:function(){this.activeIndicator&&this.activeIndicator.removeClass(this.options.activeIndicatorClass);var t=this.options;this.destroyEventListeners(),this.pause(),this._velm.hide(),this._velm.removeClass([t.displayClass,t.singleClass,t.leftEdgeClass,t.rightEdgeClass]),t.hidePageScrollbars&&(document.body.style.overflow=this.bodyOverflowStyle),this.options.clearSlides&&this.resetSlides(),this.options.onclosed&&this.options.onclosed.call(this)},close:function(){var t=this;this.options.onclose&&this.options.onclose.call(this),this.support.transition&&this.options.displayTransition?(this._velm.on(this.support.transition.end,function i(s){s.target===t._elm&&(t._velm.off(t.support.transition.end,i),t.handleClose())}),this._velm.removeClass(this.options.displayClass)):this.handleClose()},circle:function(t){return(this.num+t%this.num)%this.num},move:function(t,i,s){this.translateX(t,i,s),this.positions[t]=i},translate:function(t,i,s,e){var o=this.slides[t].style,n=this.support.transition,l=this.support.transform;o[n.name+"Duration"]=e+"ms",o[l.name]="translate("+i+"px, "+s+"px)"+(l.translateZ?" translateZ(0)":"")},translateX:function(t,i,s){this.translate(t,i,0,s)},translateY:function(t,i,s){this.translate(t,0,i,s)},animate:function(t,i,s){if(s)var e=this,o=(new Date).getTime(),n=window.setInterval(function(){var l=(new Date).getTime()-o;if(l>s)return e.slidesContainer[0].style.left=i+"px",e.ontransitionend(),void window.clearInterval(n);e.slidesContainer[0].style.left=(i-t)*(Math.floor(l/s*100)/100)+t+"px"},4);else this.slidesContainer[0].style.left=i+"px"},onresize:function(){this.initSlides(!0)},onmousedown:function(t){t.which&&1===t.which&&"VIDEO"!==t.target.nodeName&&"AUDIO"!==t.target.nodeName&&(t.preventDefault(),(t.originalEvent||t).touches=[{pageX:t.pageX,pageY:t.pageY}],this.ontouchstart(t))},onmousemove:function(t){this.touchStart&&((t.originalEvent||t).touches=[{pageX:t.pageX,pageY:t.pageY}],this.ontouchmove(t))},onmouseup:function(t){this.touchStart&&(this.ontouchend(t),delete this.touchStart)},onmouseout:function(t){if(this.touchStart){var s=t.target,e=t.relatedTarget;e&&(e===s||i.contains(s,e))||this.onmouseup(t)}},ontouchstart:function(t){this.options.stopTouchEventsPropagation&&s.stop(t);var i=(t.originalEvent||t).touches[0];this.touchStart={x:i.pageX,y:i.pageY,time:Date.now()},this.isScrolling=void 0,this.touchDelta={}},ontouchmove:function(t){this.options.stopTouchEventsPropagation&&s.stop(t);var i,e,o=(t.originalEvent||t).touches[0],n=(t.originalEvent||t).scale,l=this.index;if(!(o.length>1||n&&1!==n))if(this.options.disableScroll&&t.preventDefault(),this.touchDelta={x:o.pageX-this.touchStart.x,y:o.pageY-this.touchStart.y},i=this.touchDelta.x,void 0===this.isScrolling&&(this.isScrolling=this.isScrolling||Math.abs(i)<Math.abs(this.touchDelta.y)),this.isScrolling)this.translateY(l,this.touchDelta.y+this.positions[l],0);else for(t.preventDefault(),window.clearTimeout(this.timeout),this.options.continuous?e=[this.circle(l+1),l,this.circle(l-1)]:(this.touchDelta.x=i/=!l&&i>0||l===this.num-1&&i<0?Math.abs(i)/this.slideWidth+1:1,e=[l],l&&e.push(l-1),l<this.num-1&&e.unshift(l+1));e.length;)l=e.pop(),this.translateX(l,i+this.positions[l],0)},ontouchend:function(t){this.options.stopTouchEventsPropagation&&s.stop(t);var i,e,o,n,l,h=this.index,a=this.options.transitionSpeed,r=this.slideWidth,d=Number(Date.now()-this.touchStart.time)<250,c=d&&Math.abs(this.touchDelta.x)>20||Math.abs(this.touchDelta.x)>r/2,u=!h&&this.touchDelta.x>0||h===this.num-1&&this.touchDelta.x<0,p=!c&&this.options.closeOnSwipeUpOrDown&&(d&&Math.abs(this.touchDelta.y)>20||Math.abs(this.touchDelta.y)>this.slideHeight/2);this.options.continuous&&(u=!1),i=this.touchDelta.x<0?-1:1,this.isScrolling?p?this.close():this.translateY(h,0,a):c&&!u?(e=h+i,o=h-i,n=r*i,l=-r*i,this.options.continuous?(this.move(this.circle(e),n,0),this.move(this.circle(h-2*i),l,0)):e>=0&&e<this.num&&this.move(e,n,0),this.move(h,this.positions[h]+n,a),this.move(this.circle(o),this.positions[this.circle(o)]+n,a),h=this.circle(o),this.onslide(h)):this.options.continuous?(this.move(this.circle(h-1),-r,a),this.move(h,0,a),this.move(this.circle(h+1),r,a)):(h&&this.move(h-1,-r,a),this.move(h,0,a),h<this.num-1&&this.move(h+1,r,a))},ontouchcancel:function(t){this.touchStart&&(this.ontouchend(t),delete this.touchStart)},ontransitionend:function(i){var s=this.slides[this.index];i&&s!==i.target||(this.interval&&this.play(),t.defer(this.options.onslideend,[this.index,s]))},oncomplete:function(i){var s,o=i.target||i.srcElement,n=o&&o.parentNode;o&&n&&(s=this.getNodeIndex(n),e(n).removeClass(this.options.slideLoadingClass),"error"===i.type?(e(n).addClass(this.options.slideErrorClass),this.elements[s]=3):this.elements[s]=2,o.clientHeight>this._velm.clientHeight()&&(o.style.maxHeight=this._velm.clientHeight()),this.interval&&this.slides[this.index]===n&&this.play(),t.defer(this.options.onslidecomplete,[s,n]))},onload:function(t){this.oncomplete(t)},onerror:function(t){this.oncomplete(t)},onkeydown:function(t){switch(t.which||t.keyCode){case 13:this.options.toggleControlsOnReturn&&(s.stop(t),this.toggleControls());break;case 27:this.options.closeOnEscape&&(this.close(),t.stopImmediatePropagation());break;case 32:this.options.toggleSlideshowOnSpace&&(s.stop(t),this.toggleSlideshow());break;case 37:this.options.enableKeyboardNavigation&&(s.stop(t),this.prev());break;case 39:this.options.enableKeyboardNavigation&&(s.stop(t),this.next())}},handleClick:function(t){var i=this.options,o=t.target||t.srcElement,n=o.parentNode;if(n===this.indicatorContainer[0])return s.stop(t),void this.slide(this.getNodeIndex(o));if(n.parentNode===this.indicatorContainer[0])return this.preventDefault(t),void this.slide(this.getNodeIndex(n));function l(t){return e(o).hasClass(t)||e(n).hasClass(t)}l(i.toggleClass)?(s.stop(t),this.toggleControls()):l(i.prevClass)?(s.stop(t),this.prev()):l(i.nextClass)?(s.stop(t),this.next()):l(i.closeClass)?(s.stop(t),this.close()):l(i.playPauseClass)?(s.stop(t),this.toggleSlideshow()):n===this.slidesContainer[0]?i.closeOnSlideClick?(s.stop(t),this.close()):i.toggleControlsOnSlideClick&&(s.stop(t),this.toggleControls()):n.parentNode&&n.parentNode===this.slidesContainer[0]&&i.toggleControlsOnSlideClick&&(s.stop(t),this.toggleControls())},onclick:function(t){if(!(this.options.emulateTouchEvents&&this.touchDelta&&(Math.abs(this.touchDelta.x)>20||Math.abs(this.touchDelta.y)>20)))return this.handleClick(t);delete this.touchDelta},updateEdgeClasses:function(t){t?this._velm.removeClass(this.options.leftEdgeClass):this._velm.addClass(this.options.leftEdgeClass),t===this.num-1?this._velm.addClass(this.options.rightEdgeClass):this._velm.removeClass(this.options.rightEdgeClass)},handleSlide:function(t){this.options.continuous||this.updateEdgeClasses(t),this.loadElements(t),this.options.unloadElements&&this.unloadElements(t),this.setTitle(t),this.setActiveIndicator(t)},onslide:function(i){this.index=i,this.handleSlide(i),t.defer(this.options.onslide,[i,this.slides[i]])},setTitle:function(t){var i=this.slides[t].firstChild,s=i.title||i.alt,e=this.titleElement;e.length&&(this.titleElement.empty(),s&&e[0].appendChild(document.createTextNode(s)))},setTimeout:function(t,i,s){var e=this;return t&&window.setTimeout(function(){t.apply(e,i||[])},s||0)},createElement:function(t,i){var s=this.options.renderItem(t,i);return e(s).addClass(this.options.slideContentClass),s},loadElement:function(t){this.elements[t]||(this.slides[t].firstChild?this.elements[t]=e(this.slides[t]).hasClass(this.options.slideErrorClass)?3:2:(this.elements[t]=1,e(this.slides[t]).addClass(this.options.slideLoadingClass),this.slides[t].appendChild(this.createElement(this.list[t],this.proxyListener))))},loadElements:function(t){var i,s=Math.min(this.num,2*this.options.preloadRange+1),e=t;for(i=0;i<s;i+=1)e+=i*(i%2==0?-1:1),e=this.circle(e),this.loadElement(e)},unloadElements:function(t){var i,s;for(i in this.elements)this.elements.hasOwnProperty(i)&&(s=Math.abs(t-i))>this.options.preloadRange&&s+this.options.preloadRange<this.num&&(this.unloadSlide(i),delete this.elements[i])},addSlide:function(t){var i=this.slidePrototype.cloneNode(!1);i.setAttribute("data-index",t),this.slidesContainer[0].appendChild(i),this.slides.push(i),this.addIndicator(t)},positionSlide:function(t){var i=this.slides[t];i.style.width=this.slideWidth+"px",this.support.transform&&(i.style.left=t*-this.slideWidth+"px",this.move(t,this.index>t?-this.slideWidth:this.index<t?this.slideWidth:0,0))},initSlides:function(t){var i,s;for(t||(this.indicatorContainer=this._velm.query(this.options.indicatorContainer),this.indicatorContainer.length&&(this.indicatorPrototype=document.createElement("li"),this.indicators=this.indicatorContainer[0].children)),t||(this.positions=[],this.positions.length=this.num,this.elements={},this.imagePrototype=document.createElement("img"),this.elementPrototype=document.createElement("div"),this.slidePrototype=document.createElement("div"),e(this.slidePrototype).addClass(this.options.slideClass),this.slides=this.slidesContainer[0].children,i=this.options.clearSlides||this.slides.length!==this.num),this.slideWidth=this._velm.clientWidth(),this.slideHeight=this._velm.clientHeight(),this.slidesContainer[0].style.width=this.num*this.slideWidth+"px",i&&this.resetSlides(),s=0;s<this.num;s+=1)i&&this.addSlide(s),this.positionSlide(s);this.options.continuous&&this.support.transform&&(this.move(this.circle(this.index-1),-this.slideWidth,0),this.move(this.circle(this.index+1),this.slideWidth,0)),this.support.transform||(this.slidesContainer[0].style.left=this.index*-this.slideWidth+"px")},unloadSlide:function(t){var i,s;null!==(s=(i=this.slides[t]).firstChild)&&i.removeChild(s)},unloadAllSlides:function(){var t,i;for(t=0,i=this.slides.length;t<i;t++)this.unloadSlide(t)},toggleControls:function(){var t=this.options.controlsClass;this._velm.hasClass(t)?this._velm.removeClass(t):this._velm.addClass(t)},toggleSlideshow:function(){this.interval?this.pause():this.play()},getNodeIndex:function(t){return parseInt(t.getAttribute("data-index"),10)},initStartIndex:function(){var t=this.options.index;this.index=this.circle(parseInt(t,10)||0)},initEventListeners:function(){var t=this,i=this.slidesContainer;function s(i){var s=t.support.transition&&t.support.transition.end===i.type?"transitionend":i.type;t["on"+s](i)}e(window).on("resize",s),e(document.body).on("keydown",s),this._velm.on("click",s),this.support.touch?i.on("touchstart touchmove touchend touchcancel",s):this.options.emulateTouchEvents&&this.support.transition&&i.on("mousedown mousemove mouseup mouseout",s),this.support.transition&&i.on(this.support.transition.end,s),this.proxyListener=s},destroyEventListeners:function(){var t=this.slidesContainer,i=this.proxyListener;e(window).off("resize",i),e(document.body).off("keydown",i),this._velm.off("click",i),this.support.touch?t.off("touchstart touchmove touchend touchcancel",i):this.options.emulateTouchEvents&&this.support.transition&&t.off("mousedown mousemove mouseup mouseout",i),this.support.transition&&t.off(this.support.transition.end,i)},handleOpen:function(){this.options.onopened&&this.options.onopened.call(this)},initWidget:function(){var t=this;if(this.slidesContainer=this._velm.query(this.options.slidesContainer).first(),!this.slidesContainer.length)return!1;this.titleElement=this._velm.query(this.options.titleElement).first(),1===this.num&&this._velm.addClass(this.options.singleClass),this.options.onopen&&this.options.onopen.call(this),this.support.transition&&this.options.displayTransition?this._velm.on(this.support.transition.end,function i(s){s.target===t._elm&&(t._velm.off(t.support.transition.end,i),t.handleOpen())}):this.handleOpen(),this.options.hidePageScrollbars&&(this.bodyOverflowStyle=document.body.style.overflow,document.body.style.overflow="hidden"),this._velm.show(),this.initSlides(),this._velm.addClass(this.options.displayClass)},initOptions:function(i){this.overrided(t.mixin({},SliderView.prototype.options,i)),this.num<3&&(this.options.continuous=!!this.options.continuous&&null),this.support.transition||(this.options.emulateTouchEvents=!1)}});return o.register(l),n.Slidable=l});
//# sourceMappingURL=sourcemaps/Slidable.js.map
